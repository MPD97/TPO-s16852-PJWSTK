/**
 *
 *  @author Ambroziak Mateusz S16852
 *
 */

package zad1;

import java.awt.BorderLayout;
import java.io.IOException;

import javax.swing.JButton;

import org.json.JSONObject;

import javafx.application.Application;
import javafx.beans.value.ChangeListener;
import javafx.beans.value.ObservableValue;
import javafx.collections.FXCollections;
import javafx.collections.ObservableList;
import javafx.embed.swing.JFXPanel;
import javafx.geometry.Insets;
import javafx.scene.Scene;
import javafx.scene.control.Button;
import javafx.scene.control.ComboBox;
import javafx.scene.control.Label;
import javafx.scene.control.Tab;
import javafx.scene.control.TabPane;
import javafx.scene.control.TextArea;
import javafx.scene.control.TabPane.TabClosingPolicy;
import javafx.scene.layout.BorderPane;
import javafx.scene.layout.GridPane;
import javafx.scene.layout.HBox;
import javafx.scene.web.WebEngine;
import javafx.scene.web.WebView;
import javafx.stage.Stage;

public class Main extends Application{
	
	
	private static Service s;
	private static String weatherJson;
	private static Double rate1;
	private static Double rate2;
	private static String wikiAddress;
	
  private Scene mainScene; 
  private BorderPane mainContainer, navContainer;
  private HBox buttonsContainer;

  private TextArea textArea;
  private Button pobierzPogode, pobierzKursWaluty, pobierzKursNBP, pobierzOpis;

  private WebView browser;  

  // =============================================================================
  
	
	
  public static void main(String[] args) throws IOException, GetRateForException, GetNBPRateException {
    s = new Service("Kanada");
    
	weatherJson = s.getWeather("Toronto");
	rate1 = s.getRateFor("USD");
	rate2 = s.getNBPRate();
	wikiAddress = s.getWiki("Toronto");
  
	launch(args);    
  }


  private void prepareScene(Stage primaryStage) {    
  
  	
      mainContainer = new BorderPane();
      mainContainer.setPadding(new Insets(15, 15, 15, 15)); 
      
      textArea = new TextArea();
      mainContainer.setCenter(textArea);
      
      navContainer = new BorderPane();
      navContainer.setPadding(new Insets(0, 5, 10, 5));  
      
      buttonsContainer = new HBox(10);
      
      pobierzPogode = new Button("Weather");
      pobierzKursWaluty = new Button("Rate");
      pobierzKursNBP = new Button("NBP Rate");
      pobierzOpis = new Button("Wiki");
      
      buttonsContainer.getChildren().add(pobierzPogode);
      buttonsContainer.getChildren().add(pobierzKursWaluty);
      buttonsContainer.getChildren().add(pobierzKursNBP);
      buttonsContainer.getChildren().add(pobierzOpis);
      
      pobierzPogode.setOnAction((event) -> 
      {	
    	  textArea.setText(sformatujPogode(weatherJson));
          mainContainer.setCenter(textArea);
	  });
      
      pobierzKursWaluty.setOnAction((event) -> 
      {
    	  textArea.setText(rate1.toString());
          mainContainer.setCenter(textArea);
      });
      
      pobierzKursNBP.setOnAction((event) -> 	    
      {
    	  textArea.setText(rate2.toString());
          mainContainer.setCenter(textArea);
      });
      
      pobierzOpis.setOnAction((event) -> 
      {		  
          browser.getEngine().load(wikiAddress);  
          mainContainer.setCenter(browser);

      });
       
      navContainer.setCenter(buttonsContainer);
      mainContainer.setTop(navContainer);
            
      browser = new WebView();
      mainScene = new Scene(mainContainer, 800, 600);
  }


	private void SetScene(Stage primaryStage, Scene scene) {
		primaryStage.setScene(scene);
		primaryStage.show();
	}


	@Override
	public void start(Stage primaryStage) {   
		prepareScene(primaryStage);
		      
		primaryStage.setTitle("City Info");
		SetScene(primaryStage, mainScene);
	}

	public String sformatujPogode(String tekstNiesformatowany) 
	{
		String tekstSformatowany = "";
		try 
		{
			JSONObject jsonObj = new JSONObject(tekstNiesformatowany);
			if (!jsonObj.isNull("main")) 
			{
				tekstSformatowany += "Temperatura: " + jsonObj.getJSONObject("main").get("temp") + "\n";
				tekstSformatowany += "Temperatura minimalna: " + jsonObj.getJSONObject("main").get("temp_min") + "\n";
				tekstSformatowany += "Temperatura maksymalna: " + jsonObj.getJSONObject("main").get("temp_max") + "\n";
				tekstSformatowany += "Wilgotność: " + jsonObj.getJSONObject("main").get("humidity") + "\n";
				tekstSformatowany += "Ciśnienie: " + jsonObj.getJSONObject("main").get("pressure");
			}
	  	} catch (Exception e) 
		{
	  		e.printStackTrace();
		}
  		return tekstSformatowany;
	}
}





































